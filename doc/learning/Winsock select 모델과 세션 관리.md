# Winsock select 모델과 세션 관리

## 1. Winsock `select` 모델이란?

Winsock API에서 `select` 모델은 여러 소켓의 상태 변화를 감지하고, 비동기적으로 I/O 작업을 처리할 수 있게 해주는 메커니즘입니다. 특정 소켓에 읽을 데이터가 있는지, 데이터를 쓸 준비가 되었는지, 또는 오류가 발생했는지 등을 블로킹 없이 확인할 수 있습니다.

이는 단일 스레드 환경에서도 다수의 클라이언트 연결을 효율적으로 관리할 수 있게 해주며, 서버 프로그램의 응답성과 확장성을 높이는 데 기여합니다.

## 2. `select` 함수의 주요 파라미터 및 사용법

`select` 함수는 일반적으로 다음과 같은 형태로 사용됩니다.

```cpp
int select(
  int           nfds,      // 검사할 파일 디스크립터의 총 개수 (일반적으로 무시됨, 0으로 설정)
  fd_set        *readfds,  // 읽기 상태를 검사할 소켓 집합
  fd_set        *writefds, // 쓰기 상태를 검사할 소켓 집합
  fd_set        *exceptfds,// 예외 상태를 검사할 소켓 집합
  const timeval *timeout   // select 함수의 대기 시간 (NULL이면 무한 대기)
);
```

- `fd_set`: 소켓 파일 디스크립터의 집합을 나타내는 구조체입니다. `FD_ZERO`, `FD_SET`, `FD_CLR`, `FD_ISSET` 매크로를 사용하여 관리합니다.
- `timeout`: `select` 함수가 소켓의 상태 변화를 기다리는 최대 시간을 설정합니다.
    - `NULL`: 상태 변화가 있을 때까지 무한정 대기합니다.
    - `0`으로 설정된 `timeval` 구조체: 즉시 반환하며, 현재 소켓 상태만 확인합니다 (non-blocking polling).
    - 특정 시간 값으로 설정된 `timeval` 구조체: 해당 시간 동안만 대기합니다.

`select` 함수는 상태 변화가 감지된 소켓의 수를 반환하며, 각 `fd_set`에는 상태 변화가 발생한 소켓들만 남게 됩니다.

## 3. `GameServer.cpp`에서의 `select` 모델 활용

`GameServer.cpp`에서는 `select` 모델을 사용하여 여러 클라이언트의 연결 요청 및 데이터 수신 이벤트를 비동기적으로 처리합니다.

- **리스닝 소켓**: 새로운 클라이언트 연결 요청이 있는지 확인합니다 (`FD_ISSET`으로 리스닝 소켓 검사).
- **클라이언트 소켓**: 기존에 연결된 클라이언트로부터 데이터 수신이 있는지 확인합니다 (`FD_ISSET`으로 각 클라이언트 소켓 검사).

이를 통해 서버는 각 클라이언트의 요청을 기다리며 다른 작업을 멈추는 대신, 이벤트가 발생한 소켓에 대해서만 적절한 처리를 수행할 수 있습니다.

## 4. 클라이언트 세션 관리의 중요성

`GameServer.cpp`에 추가된 `TODO` 주석은 클라이언트 연결이 종료되었을 때 해당 클라이언트의 세션 정보를 서버에서 적절히 제거해야 함을 명시합니다.

`select` 모델을 통해 클라이언트의 연결 종료(예: `recv` 함수가 0을 반환하거나 오류 발생)를 감지할 수 있습니다. 연결 종료가 확인되면, 서버는 해당 클라이언트와 관련된 다음과 같은 자원들을 정리해야 합니다.

- 해당 클라이언트 소켓을 `fd_set`에서 제거 (`FD_CLR`).
- 서버 내부에 유지하고 있던 클라이언트 세션 정보 (예: 사용자 ID, 상태 정보 등)를 삭제.
- 할당된 메모리나 기타 시스템 자원 해제.

이러한 세션 관리는 서버의 자원 누수를 방지하고, 안정적인 서비스 운영을 위해 매우 중요합니다. `TODO`로 명시된 부분은 향후 이 로직을 구현하여 서버의 견고성을 높이기 위함입니다.
