# 패킷 핸들러 및 프로토콜 구조 리팩토링

## 1. 개요

본 문서는 CPPServer 프로젝트의 패킷 핸들러 구조와 프로토콜 관련 파일 구성 변경 사항을 설명합니다. 이번 리팩토링은 코드의 명확성을 높이고, 클라이언트와 서버 간의 데이터 구조 공유를 개선하며, 유지보수성을 향상시키는 것을 목표로 합니다.

주요 변경 사항은 다음과 같습니다:
- 패킷 핸들러 클래스 명칭 및 위치 변경
- 프로토콜 버퍼를 사용한 공유 열거형(Enum) 및 구조체(Struct) 파일 도입

## 2. 패킷 핸들러 변경 사항

기존의 패킷 핸들러 파일들이 삭제되고, 새로운 위치와 명칭으로 재구성되었습니다.

-   **DummyClient:**
    -   기존 `ClientPacketHandler` (클라이언트가 서버로 보내는 패킷을 처리하거나 생성하는 로직으로 추정)가 삭제되었습니다.
    -   새로운 `ServerPacketHandler` (`DummyClient/ServerPacketHandler.cpp`, `DummyClient/ServerPacketHandler.h`)가 추가되었습니다. 이 핸들러는 서버로부터 수신된 패킷을 처리하는 역할을 담당합니다.
-   **GameServer:**
    -   기존 `ServerPacketHandler` (서버가 클라이언트로부터 받은 패킷을 처리하는 로직으로 추정)가 삭제되었습니다.
    -   새로운 `ClientPacketHandler` (`GameServer/ClientPacketHandler.cpp`, `GameServer/ClientPacketHandler.h`)가 추가되었습니다. 이 핸들러는 클라이언트로부터 수신된 패킷을 처리하는 역할을 담당합니다.

이러한 변경은 각 애플리케이션(클라이언트 또는 서버)의 관점에서 "상대방"으로부터 오는 패킷을 처리하는 핸들러의 명칭을 보다 직관적으로 만듭니다.

## 3. 프로토콜 버퍼 기반 공유 데이터 구조 도입

이번 리팩토링에서는 프로토콜 버퍼를 사용하여 클라이언트와 서버 간에 공유될 필요가 있는 열거형(Enum)과 구조체(Struct)를 별도의 파일로 정의했습니다.

-   `Enum.proto` -> `Enum.pb.cc`, `Enum.pb.h`
-   `Struct.proto` -> `Struct.pb.cc`, `Struct.pb.h`

이 파일들은 `DummyClient`와 `GameServer` 프로젝트 양쪽에 모두 포함되어, 동일한 데이터 정의를 공유하게 됩니다.

### 3.1. `Enum.pb.h/cc`
-   네트워크 패킷에서 사용될 다양한 상태 코드, 타입 식별자 등의 열거형을 정의합니다.
-   예시: `PacketType`, `PlayerState` 등

### 3.2. `Struct.pb.h/cc`
-   패킷 내에서 사용될 복합 데이터 구조체를 정의합니다.
-   예시: `PlayerData`, `ItemInfo` 등

이러한 공유 데이터 구조의 도입은 다음과 같은 이점을 제공합니다:
-   **일관성 유지:** 클라이언트와 서버가 동일한 데이터 규약을 사용함으로써 불일치로 인한 오류를 줄입니다.
-   **코드 중복 감소:** 공통으로 사용되는 데이터 구조를 한 곳에서 관리합니다.
-   **유지보수 용이성:** 데이터 구조 변경 시 관련된 모든 프로젝트에 일관되게 반영하기 용이합니다.

## 4. 기존 `Protocol.pb.h/cc` 와의 관계

기존 `Protocol.pb.h/cc` 파일은 주로 실제 통신에 사용되는 메시지 타입(패킷의 본문)을 정의하는 역할을 계속 수행할 것으로 보입니다. 새로 추가된 `Enum.pb`와 `Struct.pb`는 이러한 메시지 타입 내에서 사용될 기본적인 데이터 타입이나 식별자를 제공하여 `Protocol.pb`의 정의를 보조하고 명확하게 합니다.

## 5. 기대 효과

-   패킷 처리 로직의 명확성 증대
-   프로토콜 관련 코드의 중앙 관리 및 재사용성 향상
-   클라이언트-서버 간 데이터 동기화 오류 감소
-   전반적인 코드베이스의 가독성 및 유지보수성 개선

## 6. 향후 고려 사항

-   새로운 핸들러 및 프로토콜 구조에 맞춰 기존 패킷 생성 및 처리 로직이 올바르게 마이그레이션 되었는지 충분한 테스트가 필요합니다.
-   프로토콜 문서(`README.md` 또는 별도 문서)를 최신화하여 변경된 구조를 반영해야 합니다.
